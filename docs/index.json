[{
    "title": "AWS e Azure: Armazenamento de objetos",
    "date": "",
    "description": "'Tradução' dos nomes entre os cloud providers",
    "body": "Se você conhece bastante de um Cloud Provider, acredito que o primeiro passo para estudar um segundo seria entender o básico da equivalência entre eles, meio que um \u0026ldquo;dicionário\u0026rdquo; para traduzir entre dois conjuntos distintos de vocabulários.\nSempre existirão diferenças conceituais estruturantes, em especial nos Cloud Providers que vieram depois e puderam arranjar, de maneira mais elegante, a apresentação dos seus serviços.\nNo fim do dia, uma máquina virtual é uma máquina virtual. Se você chama o disco de Elastic Block Storage volume ou Azure Disk, ele segue sendo um disco de uma máquina virtual.\nAbaixo seguem alguns tópicos relevantes de mapeamento de um para o outro.\n    Azure Blob AWS S3 Observações     Arquivos Blob Objeto    Pastas - - As \u0026lsquo;pastas\u0026rsquo; não existem, são um recurso visual derivando as \u0026lsquo;/\u0026rsquo; dos nomes   Raiz do armazenamento Container Bucket O nome do Bucket na AWS é global; usuários não podem repetir nomes de buckets que já existem;   Hierarquia adicional Storage Account - O nome da Storage Account é global; usuários não podem repetir nomes de Storage Accounts que já existem;   Hierarquia adicional Resource Group - Nada existe na Azure sem pertencer a um Resource Group.    Logo, para a Azure, arquivos são Blobs armazenados em Containers que pertencem a uma Storage Account de um Resource Group. Já para a AWS, arquivos são objetos armazenados em Buckets do serviço S3.\nA própria Microsoft postou uma comparação sobre as diferenças, mas pouco relevante em explorar a terminologia.\n    Azure Blob AWS S3 Observações     Tamanho máximo de arquivos Variável de acordo com o tipo. Padrão é 190TB 5 TB Diferentes tipos de blobs na Azure   Classes Hot, Cool, Archive Standard,Infrequent Access, os mesmos mas com Redundância reduzida (One Zone), Reduced Redundancy, Glacier, Glacier Deep Archive    Classes Local (LRS), Zone (ZRS S3 One Zone, Standard    Classes Geo (GRS), Geozone (GZRS) S3IA/S3 com Cross Region Replication GZRS faz replicação entre zonas de uma mesma Region   Classes Cool Blob Storage Infrequent Access    Classes Storage Archive Blob Storage Glacier    Integração com CDN Container $web de uma Storage Account com o recurso habilitado Bucket com configuração especializada.     Bônus: linha de comando Tudo bem que a aws cli é muito pouco intuitiva para a trabalhar com buckets, mas ainda assim, é bem simples.\n# # mb de 'make bucket' :O # aws s3 mb s3://dev-sres-first-bucket make_bucket: dev-sres-first-bucket # aws s3 ls 2020-12-04 23:42:42 dev-sres-first-bucket Upload de arquivos: também tranquilo:\n# aws s3 cp teste s3://dev-sres-first-bucket upload: ./teste to s3://dev-sres-first-bucket/teste # aws s3 ls s3://dev-sres-first-bucket 2020-12-04 23:44:46 6 teste E na Azure?\nVocê precisa:\n criar um \u0026lsquo;resource group\u0026rsquo;:  # az group create --name so-queria-criar-um-bucket RequiredArgumentMissingError: the following arguments are required: --location/-l Try this: 'az group create -l westus -n MyResourceGroup' # tá bom, dá pra configurar a zona default para ele não ficar pedindo; eu já havia feito no AWS cli, então desconsidere: # az configure --defaults location=eastus { \u0026quot;id\u0026quot;: \u0026quot;/subscriptions/f2b2b75e-5917-4ab1-9efd-d8fd48095700/resourceGroups/so-queria-criar-um-bucket\u0026quot;, \u0026quot;location\u0026quot;: \u0026quot;eastus\u0026quot;, \u0026quot;managedBy\u0026quot;: null, \u0026quot;name\u0026quot;: \u0026quot;so-queria-criar-um-bucket\u0026quot;, \u0026quot;properties\u0026quot;: { \u0026quot;provisioningState\u0026quot;: \u0026quot;Succeeded\u0026quot; }, \u0026quot;tags\u0026quot;: null, \u0026quot;type\u0026quot;: \u0026quot;Microsoft.Resources/resourceGroups\u0026quot; } # verbose much, huh?  Criar um \u0026lsquo;storage account\u0026rsquo;:  # az storage account create -n por-favor-so-um-bucket -g so-queria-criar-um-bucket BadRequestError: (AccountNameInvalid) por-favor-so-queria-um-bucket is not a valid storage account name. Storage account name must be between 3 and 24 characters in length and use numbers and lower-case letters only. # # NA AWS O LIMITE É 63 CARACTERES E DEIXA HIFENS!!!!!! az storage account create -n prfvrmeubucket -g so-queria-criar-um-bucket ... 2 min depois ... {- Finished .. \u0026quot;accessTier\u0026quot;: \u0026quot;Hot\u0026quot;, \u0026quot;allowBlobPublicAccess\u0026quot;: null, \u0026quot;azureFilesIdentityBasedAuthentication\u0026quot;: null, \u0026quot;blobRestoreStatus\u0026quot;: null, \u0026quot;creationTime\u0026quot;: \u0026quot;2020-12-05T03:02:26.090589+00:00\u0026quot;, \u0026quot;customDomain\u0026quot;: null, \u0026quot;enableHttpsTrafficOnly\u0026quot;: true, \u0026quot;encryption\u0026quot;: { \u0026quot;keySource\u0026quot;: \u0026quot;Microsoft.Storage\u0026quot;, \u0026quot;keyVaultProperties\u0026quot;: null, \u0026quot;requireInfrastructureEncryption\u0026quot;: null, \u0026quot;services\u0026quot;: { \u0026quot;blob\u0026quot;: { \u0026quot;enabled\u0026quot;: true, \u0026quot;keyType\u0026quot;: \u0026quot;Account\u0026quot;, \u0026quot;lastEnabledTime\u0026quot;: \u0026quot;2020-12-05T03:02:26.184345+00:00\u0026quot; }, \u0026quot;file\u0026quot;: { \u0026quot;enabled\u0026quot;: true, \u0026quot;keyType\u0026quot;: \u0026quot;Account\u0026quot;, \u0026quot;lastEnabledTime\u0026quot;: \u0026quot;2020-12-05T03:02:26.184345+00:00\u0026quot; }, \u0026quot;queue\u0026quot;: null, \u0026quot;table\u0026quot;: null } }, \u0026quot;failoverInProgress\u0026quot;: null, \u0026quot;geoReplicationStats\u0026quot;: null, \u0026quot;id\u0026quot;: \u0026quot;/subscriptions/f2b2b75e-5917-4ab1-9efd-d8fd48095700/resourceGroups/so-queria-criar-um-bucket/providers/Microsoft.Storage/storageAccounts/prfvrmeubucket\u0026quot;, \u0026quot;identity\u0026quot;: null, \u0026quot;isHnsEnabled\u0026quot;: null, \u0026quot;kind\u0026quot;: \u0026quot;StorageV2\u0026quot;, \u0026quot;largeFileSharesState\u0026quot;: null, \u0026quot;lastGeoFailoverTime\u0026quot;: null, \u0026quot;location\u0026quot;: \u0026quot;eastus\u0026quot;, \u0026quot;minimumTlsVersion\u0026quot;: null, \u0026quot;name\u0026quot;: \u0026quot;prfvrmeubucket\u0026quot;, \u0026quot;networkRuleSet\u0026quot;: { \u0026quot;bypass\u0026quot;: \u0026quot;AzureServices\u0026quot;, \u0026quot;defaultAction\u0026quot;: \u0026quot;Allow\u0026quot;, \u0026quot;ipRules\u0026quot;: [], \u0026quot;virtualNetworkRules\u0026quot;: [] }, \u0026quot;primaryEndpoints\u0026quot;: { \u0026quot;blob\u0026quot;: \u0026quot;https://prfvrmeubucket.blob.core.windows.net/\u0026quot;, \u0026quot;dfs\u0026quot;: \u0026quot;https://prfvrmeubucket.dfs.core.windows.net/\u0026quot;, \u0026quot;file\u0026quot;: \u0026quot;https://prfvrmeubucket.file.core.windows.net/\u0026quot;, \u0026quot;internetEndpoints\u0026quot;: null, \u0026quot;microsoftEndpoints\u0026quot;: null, \u0026quot;queue\u0026quot;: \u0026quot;https://prfvrmeubucket.queue.core.windows.net/\u0026quot;, \u0026quot;table\u0026quot;: \u0026quot;https://prfvrmeubucket.table.core.windows.net/\u0026quot;, \u0026quot;web\u0026quot;: \u0026quot;https://prfvrmeubucket.z13.web.core.windows.net/\u0026quot; }, \u0026quot;primaryLocation\u0026quot;: \u0026quot;eastus\u0026quot;, \u0026quot;privateEndpointConnections\u0026quot;: [], \u0026quot;provisioningState\u0026quot;: \u0026quot;Succeeded\u0026quot;, \u0026quot;resourceGroup\u0026quot;: \u0026quot;so-queria-criar-um-bucket\u0026quot;, \u0026quot;routingPreference\u0026quot;: null, \u0026quot;secondaryEndpoints\u0026quot;: { \u0026quot;blob\u0026quot;: \u0026quot;https://prfvrmeubucket-secondary.blob.core.windows.net/\u0026quot;, \u0026quot;dfs\u0026quot;: \u0026quot;https://prfvrmeubucket-secondary.dfs.core.windows.net/\u0026quot;, \u0026quot;file\u0026quot;: null, \u0026quot;internetEndpoints\u0026quot;: null, \u0026quot;microsoftEndpoints\u0026quot;: null, \u0026quot;queue\u0026quot;: \u0026quot;https://prfvrmeubucket-secondary.queue.core.windows.net/\u0026quot;, \u0026quot;table\u0026quot;: \u0026quot;https://prfvrmeubucket-secondary.table.core.windows.net/\u0026quot;, \u0026quot;web\u0026quot;: \u0026quot;https://prfvrmeubucket-secondary.z13.web.core.windows.net/\u0026quot; }, \u0026quot;secondaryLocation\u0026quot;: \u0026quot;westus\u0026quot;, \u0026quot;sku\u0026quot;: { \u0026quot;name\u0026quot;: \u0026quot;Standard_RAGRS\u0026quot;, \u0026quot;tier\u0026quot;: \u0026quot;Standard\u0026quot; }, \u0026quot;statusOfPrimary\u0026quot;: \u0026quot;available\u0026quot;, \u0026quot;statusOfSecondary\u0026quot;: \u0026quot;available\u0026quot;, \u0026quot;tags\u0026quot;: {}, \u0026quot;type\u0026quot;: \u0026quot;Microsoft.Storage/storageAccounts\u0026quot; } # # VERBOSE MUCH ?  Finalmente, criar um container:  # az storage container create --account-name prfvrmeubucket --name plmorddeus-um-bucket There are no credentials provided in your command and environment, we will query for the account key inside your storage account. Please provide --connection-string, --account-key or --sas-token as credentials, or use `--auth-mode login` if you have required RBAC roles in your command. For more information about RBAC roles in storage, visit https://docs.microsoft.com/en-us/azure/storage/common/storage-auth-aad-rbac-cli. Setting the corresponding environment variables can avoid inputting credentials in your command. Please use --help to get more information. { \u0026quot;created\u0026quot;: true } # # Que alerta esquisito! Agora, podemos fazer o upload!\nVamos fazer certo, ele falou que eu devo especificar \u0026ndash;auth-mode login para remover a mensagem de erro:\n# az storage blob upload --account-name prfvrmeubucket --container-name plmorddeus-um-bucket --name yay --file teste --auth-mode login UnknownError: You do not have the required permissions needed to perform this operation. Depending on your operation, you may need to be assigned one of the following roles: \u0026quot;Storage Blob Data Contributor\u0026quot; \u0026quot;Storage Blob Data Reader\u0026quot; \u0026quot;Storage Queue Data Contributor\u0026quot; \u0026quot;Storage Queue Data Reader\u0026quot; If you want to use the old authentication method and allow querying for the right account key, please use the \u0026quot;--auth-mode\u0026quot; parameter and \u0026quot;key\u0026quot; value. # # nay Para você fazer do jeito certo, você precisa atribuir a função de \u0026lsquo;colaborador de dados do blob de armazenamento\u0026rsquo; para o seu usuário que já é administrador. Porque né, é importante:\n# # Uma linha tranquila e trivial. # az ad signed-in-user show --query objectId -o tsv | az role assignment create --query objectId -o tsv --role \u0026quot;Storage Blob Data Contributor\u0026quot; --assignee @- --scope \u0026quot;/subscriptions/f2b2b75e-5917-4ab1-9efd-d8fd48 095700/resourceGroups/so-queria-criar-um-bucket/providers/Microsoft.Storage/storageAccounts/prfvrmeubucket\u0026quot; Será que agora vai?\n# az storage blob upload --account-name prfvrmeubucket --container-name plmorddeus-um-bucket --name yay --file teste --auth-mode login UnknownError: You do not have the required permissions needed to perform this operation. Depending on your operation, you may need to be assigned one of the following roles: \u0026quot;Storage Blob Data Contributor\u0026quot; \u0026quot;Storage Blob Data Reader\u0026quot; \u0026quot;Storage Queue Data Contributor\u0026quot; \u0026quot;Storage Queue Data Reader\u0026quot; If you want to use the old authentication method and allow querying for the right account key, please use the \u0026quot;--auth-mode\u0026quot; parameter and \u0026quot;key\u0026quot; value. Pô, mas eu fiz certo!\n(\u0026hellip;Muitos minutos depois olhando a interface e tentando descobrir o que deu errado\u0026hellip;)\nDeixa eu ler a mensagem de erro de novo:\n# az storage blob upload --account-name prfvrmeubucket --container-name plmorddeus-um-bucket --name yay --file teste --auth-mode login Finished[#############################################################] 100.0000% { \u0026quot;etag\u0026quot;: \u0026quot;\\\u0026quot;0x8D898D09C5C2921\\\u0026quot;\u0026quot;, \u0026quot;lastModified\u0026quot;: \u0026quot;2020-12-05T03:48:21+00:00\u0026quot; } Hum?\nAzure Cloud, ladies and gentlemen!\n",
    "ref": "/marcelo/blog/aws-azure-comparison-s3/"
  },{
    "title": "Sobre",
    "date": "",
    "description": "",
    "body": "O fundador da DevSREs Network Initiative, Marcelo Andrade, é entusiasta do universo Linux e software livre desde a primeira instalação do saudoso Conectiva Parolin em 1997.\nAo longo dos anos, transitou profissionalmente entre os mais diversos nomes comumente atribuídos aos profissionais de TI que não trabalham diretamente com desenvolvimento de software: sysop, sysadmin, administrador de redes, analista de redes, analista de infraestrutura, analista de suporte, engenheiro de soluções\u0026hellip; Até se auto instituir o título de Site Reliability Engineer, ou engenheiro de confiabilidade (de sites?) em português.\nA realidade é que, em todas elas, o foco é sempre o mesmo: manter ambientes on-line, garantindo performance, escalabilidade e confiabilidade aos sistemas da empresa. O que muda, com os anos, é abordagem e o conjunto de ferramentas a ser usado.\nSeu principal nicho de atuação, no momento, é a manutenção de clusters Kubernetes em conjuto com outras tecnologias Cloud Native (ou nem tanto).\n",
    "ref": "/marcelo/about/"
  },{
    "title": "Contact",
    "date": "",
    "description": "",
    "body": "",
    "ref": "/marcelo/contact/"
  }]
